{% extends "base.html" %}

{% block title %}ì‹œê°„í‘œ - WCheck{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='time_table.css') }}">
{% endblock %}

{% block header %}
<header class="full-title-header">
    <div class="title-wrap">
        <h1 class="page-title">{{ username }}ë‹˜ ì‹œê°„í‘œ</h1>
    </div>
</header>
{% endblock %}

{% block content %}
{% if error %}
<div class="error-message alert alert-danger">
    <p>{{ error }}</p>
</div>
{% endif %}

<div class="timetable-wrapper fade-in">
    <div class="timetable-main-container">
        <div class="timetable-container card">
            <table class="timetable table">
                <colgroup>
                    <col class="time-col" style="width: 90px;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                </colgroup>
                <thead>
                    <tr>
                        <th class="time-header">ì‹œê°„</th>
                        <th>ì›”</th>
                        <th>í™”</th>
                        <th>ìˆ˜</th>
                        <th>ëª©</th>
                        <th>ê¸ˆ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hour in range(9, 22) %}
                        {% for minute in [0, 30] %}
                            <tr>
                                {% if minute == 0 %}
                                    <td class="time-cell" rowspan="2">
                                        {{ "%02d"|format(hour) }}:00
                                    </td>
                                {% endif %}
                                {% for day in days %}
                                    {% set cell_data = timetable.get((hour, minute), {}).get(day) %}
                                    {% if cell_data and cell_data != 'skip' %}
                                        <td class="class-cell" rowspan="{{ cell_data.rowspan }}">
                                            <div class="class-content">
                                                <div class="subject-name">{{ cell_data.subject_name }}</div>
                                                {% if role == 'student' %}
                                                    <div class="professor-name">{{ cell_data.professor_name }}</div>
                                                {% endif %}
                                                <div class="location">{{ cell_data.location }}</div>
                                            </div>
                                        </td>
                                    {% elif cell_data == 'skip' %}
                                        {# ë³‘í•©ëœ ì…€ ìƒëµ #}
                                    {% else %}
                                        <td class="empty-cell"></td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="timetable-sidebar">
        {% if current_class %}
        <div class="class-notification-card card current-class-card">
            <div class="notification-header">
                <div class="notification-icon current-icon">ğŸ“š</div>
                <h3 class="notification-title">í˜„ì¬ ìˆ˜ì—…</h3>
            </div>
            <div class="notification-content">
                <div class="class-info-main">
                    <div class="class-subject-name">{{ current_class.subject_name }}</div>
                    {% if role == 'student' %}
                        <div class="class-professor-name">{{ current_class.professor_name }}</div>
                    {% endif %}
                    <div class="class-location">ğŸ“ {{ current_class.location }}</div>
                </div>
                <div class="class-time-info">
                    <div class="time-range">
                        {{ current_class.start_time }} - {{ current_class.end_time }}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if next_class %}
        <div class="class-notification-card card next-class-card">
            <div class="notification-header">
                <div class="notification-icon next-icon">â°</div>
                <h3 class="notification-title">ë‹¤ìŒ ìˆ˜ì—…</h3>
            </div>
            <div class="notification-content">
                <div class="class-info-main">
                    <div class="class-subject-name">{{ next_class.subject_name }}</div>
                    {% if role == 'student' %}
                        <div class="class-professor-name">{{ next_class.professor_name }}</div>
                    {% endif %}
                    <div class="class-location">ğŸ“ {{ next_class.location }}</div>
                </div>
                <div class="class-time-info">
                    <div class="time-range">
                        {{ next_class.start_time }} - {{ next_class.end_time }}
                    </div>
                    <div class="time-until">
                        {% if next_class.hours_until > 0 %}
                            <span class="time-value">{{ next_class.hours_until }}</span>ì‹œê°„ 
                            <span class="time-value">{{ next_class.minutes_until }}</span>ë¶„ í›„
                        {% else %}
                            <span class="time-value">{{ next_class.minutes_until }}</span>ë¶„ í›„
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if remaining_classes and remaining_classes|length > 0 %}
        <div class="today-classes-section">
            <h3 class="today-classes-title">ì˜¤ëŠ˜ì˜ ìˆ˜ì—…</h3>
            <div class="today-classes-list">
                {% for class_item in remaining_classes %}
                <div class="today-class-card {% if class_item.is_past %}past-class{% else %}upcoming-class{% endif %}">
                    <div class="today-class-header">
                        <div class="today-class-subject">{{ class_item.subject_name }}</div>
                        <div class="today-class-time-badge">
                            {% if class_item.is_past %}
                                <span class="badge badge-neutral">ì¢…ë£Œ</span>
                            {% else %}
                                {% if class_item.hours_until > 0 %}
                                    <span class="badge badge-info">{{ class_item.hours_until }}ì‹œê°„ {{ class_item.minutes_until }}ë¶„ í›„</span>
                                {% else %}
                                    <span class="badge badge-info">{{ class_item.minutes_until }}ë¶„ í›„</span>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="today-class-info">
                        {% if role == 'student' %}
                            <div class="today-class-professor">{{ class_item.professor_name }}</div>
                        {% endif %}
                        <div class="today-class-location">ğŸ“ {{ class_item.location }}</div>
                        <div class="today-class-time">{{ class_item.start_time }} - {{ class_item.end_time }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
