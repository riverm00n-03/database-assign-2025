<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시간표</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='time_table.css') }}">
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
</head>
<body>

<!-- ✅ 왼쪽 사이드바 -->
<div class="sidebar">
    <h2 class="sidebar-title">메뉴</h2>
    <ul id="menuList" class="menu-list"></ul>
</div>

<!-- ✅ 오른쪽 메인 콘텐츠 -->
<div class="content-area">
    <header class="full-title-header">
        <h1 class="page-title">{{ username }}님 시간표</h1>
    </header>

    <main class="main-content">
        {% if error %}
            <div class="error-message">
                <p>{{ error }}</p>
            </div>
        {% endif %}

        <div class="timetable-container">
            <table class="timetable">
                <thead>
                <tr>
                    <th>시간</th>
                    <th>월</th>
                    <th>화</th>
                    <th>수</th>
                    <th>목</th>
                    <th>금</th>
                </tr>
                </thead>
                <tbody>
                {% for hour in range(9, 22) %}
                    {% for minute in [0, 30] %}
                        <tr>
                            {% if minute == 0 %}
                                <td class="time-cell" rowspan="2">
                                    {{ "%02d"|format(hour) }}:00
                                </td>
                            {% endif %}
                            {% for day in days %}
                                {% set cell_data = timetable.get((hour, minute), {}).get(day) %}
                                {% if cell_data and cell_data != 'skip' %}
                                    <td class="class-cell" rowspan="{{ cell_data.rowspan }}">
                                        <div class="class-content">
                                            <div class="subject-name">{{ cell_data.subject_name }}</div>
                                            {% if role == 'student' %}
                                                <div class="professor-name">{{ cell_data.professor_name }}</div>
                                            {% endif %}
                                            <div class="location">{{ cell_data.location }}</div>
                                        </div>
                                    </td>
                                {% elif cell_data == 'skip' %}
                                    {# 병합된 셀 생략 #}
                                {% else %}
                                    <td></td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                {% endfor %}
                </tbody>
            </table>
        </div>
    </main>
</div>

<script>
    const userRole = "{{ role }}";
    const menuList = document.getElementById("menuList");
    let menuItems = [];

    if (userRole === "student") {
        menuItems = [
            { name: "시간표", url: "#" },
            { name: "출석체크", url: "{{ url_for('attendance.show_attendance') }}" },
            { name: "출석관리", url: "{{ url_for('attendance.manage_attendance') }}" },
            { name: "로그아웃", url: "{{ url_for('auth.logout') }}" }
        ];
    } else if (userRole === "professor") {
         menuItems = [
            { name: "오늘의 강의", url: "{{ url_for('professor.todays_classes') }}" },
            { name: "시간표", url: "{{ url_for('timetable.timetable') }}" },
            { name: "휴강 등록", url: "#" },
            { name: "로그아웃", url: "{{ url_for('auth.logout') }}" }
        ];
    }

    // 기존 구조 유지 + "시간표" 클릭 시 alert 추가
    menuItems.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `<a href="${item.url}">${item.name}</a>`;
        menuList.appendChild(li);

        // "시간표" 항목 클릭 시 알림 추가
        if (item.name === "시간표") {
            const link = li.querySelector("a");
            link.addEventListener("click", (e) => {
                e.preventDefault();
                alert("이미 시간표 페이지입니다.");
            });
            // 현재 메뉴 강조 스타일
            link.style.color = "#2563eb";
            link.style.fontWeight = "700";
        }
    });
</script>

</body>
</html>
