{% extends "base.html" %}

{% block title %}시간표 - WCheck{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='time_table.css') }}">
{% endblock %}

{% block header %}
<header class="full-title-header">
    <div class="title-wrap">
        <h1 class="page-title">{{ username }}님 시간표</h1>
    </div>
</header>
{% endblock %}

{% block content %}
{% if error %}
<div class="error-message alert alert-danger">
    <p>{{ error }}</p>
</div>
{% endif %}

<div class="timetable-wrapper fade-in">
    <div class="timetable-main-container">
        <div class="timetable-container card">
            <table class="timetable table">
                <colgroup>
                    <col class="time-col" style="width: 90px;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                    <col style="width: auto;">
                </colgroup>
                <thead>
                    <tr>
                        <th class="time-header">시간</th>
                        <th>월</th>
                        <th>화</th>
                        <th>수</th>
                        <th>목</th>
                        <th>금</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hour in range(9, 22) %}
                        {% for minute in [0, 30] %}
                            <tr>
                                {% if minute == 0 %}
                                    <td class="time-cell" rowspan="2">
                                        {{ "%02d"|format(hour) }}:00
                                    </td>
                                {% endif %}
                                {% for day in days %}
                                    {% set cell_data = timetable.get((hour, minute), {}).get(day) %}
                                    {% if cell_data and cell_data != 'skip' %}
                                        <td class="class-cell" rowspan="{{ cell_data.rowspan }}">
                                            <div class="class-content">
                                                <div class="subject-name">{{ cell_data.subject_name }}</div>
                                                {% if role == 'student' %}
                                                    <div class="professor-name">{{ cell_data.professor_name }}</div>
                                                {% endif %}
                                                <div class="location">{{ cell_data.location }}</div>
                                            </div>
                                        </td>
                                    {% elif cell_data == 'skip' %}
                                        {# 병합된 셀 생략 #}
                                    {% else %}
                                        <td class="empty-cell"></td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="timetable-sidebar">
        {% if current_class %}
        <div class="class-notification-card card current-class-card">
            <div class="notification-header">
                <div class="notification-icon current-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                </div>
                <h3 class="notification-title">현재 수업</h3>
            </div>
            <div class="notification-content">
                <div class="class-info-main">
                    <div class="class-subject-name">{{ current_class.subject_name }}</div>
                    {% if role == 'student' %}
                        <div class="class-professor-name">{{ current_class.professor_name }}</div>
                    {% endif %}
                    <div class="class-location">
                        <svg class="icon-inline" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        {{ current_class.location }}
                    </div>
                </div>
                <div class="class-time-info">
                    <div class="time-range">
                        {{ current_class.start_time }} - {{ current_class.end_time }}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if next_class %}
        <div class="class-notification-card card next-class-card">
            <div class="notification-header">
                <div class="notification-icon next-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </div>
                <h3 class="notification-title">다음 수업</h3>
            </div>
            <div class="notification-content">
                <div class="class-info-main">
                    <div class="class-subject-name">{{ next_class.subject_name }}</div>
                    {% if role == 'student' %}
                        <div class="class-professor-name">{{ next_class.professor_name }}</div>
                    {% endif %}
                    <div class="class-location">
                        <svg class="icon-inline" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        {{ next_class.location }}
                    </div>
                </div>
                <div class="class-time-info">
                    <div class="time-range">
                        {{ next_class.start_time }} - {{ next_class.end_time }}
                    </div>
                    <div class="time-until">
                        {% if next_class.hours_until > 0 %}
                            <span class="time-value">{{ next_class.hours_until }}</span>시간 
                            <span class="time-value">{{ next_class.minutes_until }}</span>분 후
                        {% else %}
                            <span class="time-value">{{ next_class.minutes_until }}</span>분 후
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% if remaining_classes and remaining_classes|length > 0 %}
        <div class="today-classes-section">
            <h3 class="today-classes-title">오늘의 수업</h3>
            <div class="today-classes-list">
                {% for class_item in remaining_classes %}
                <div class="today-class-card {% if class_item.is_past %}past-class{% else %}upcoming-class{% endif %}">
                    <div class="today-class-header">
                        <div class="today-class-subject">{{ class_item.subject_name }}</div>
                        <div class="today-class-time-badge">
                            {% if class_item.is_past %}
                                <span class="badge badge-neutral">종료</span>
                            {% else %}
                                {% if class_item.hours_until > 0 %}
                                    <span class="badge badge-info">{{ class_item.hours_until }}시간 {{ class_item.minutes_until }}분 후</span>
                                {% else %}
                                    <span class="badge badge-info">{{ class_item.minutes_until }}분 후</span>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="today-class-info">
                        {% if role == 'student' %}
                            <div class="today-class-professor">{{ class_item.professor_name }}</div>
                        {% endif %}
                        <div class="today-class-location">
                            <svg class="icon-inline" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            {{ class_item.location }}
                        </div>
                        <div class="today-class-time">{{ class_item.start_time }} - {{ class_item.end_time }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
