{% extends "base.html" %}

{% block title %}ì¶œì„ ê´€ë¦¬ - WCheck{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='attendance.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='attendance_cards.css') }}">
{% endblock %}

{% block header %}
<header class="full-title-header">
    <div class="title-wrap">
        <h1 class="page-title">{{ username }}ë‹˜ ì¶œì„ ê´€ë¦¬</h1>
    </div>
</header>
{% endblock %}

{% block content %}
<div class="attendance-container">
    <div class="hint alert alert-info">
        <span>ğŸ’¡</span>
        <span>ê³¼ëª©ë³„ ì¶œì„ í˜„í™©ì„ í™•ì¸í•˜ê³ , ìƒì„¸ ë‚´ì—­ì„ ë³´ë ¤ë©´ ì¹´ë“œë¥¼ í´ë¦­í•˜ì„¸ìš”.</span>
    </div>

    {% if enrolled_subjects %}
        <div class="attendance-cards-container fade-in">
            {% for subject in enrolled_subjects %}
                <div class="attendance-card status-{{ 'safe' if subject.status_color == 'green' else 'warning' if subject.status_color == 'orange' else 'danger' }} clickable-row" 
                     data-subject-id="{{ subject.subject_id }}">
                    <div class="card-header">
                        <h3 class="card-subject-name">{{ subject.subject_name }}</h3>
                        <p class="card-professor-name">{{ subject.professor_name or 'êµìˆ˜ ì •ë³´ ì—†ìŒ' }}</p>
                    </div>
                    <div class="card-body">
                        <div class="card-percentage">
                            <span class="card-percentage-value">{{ subject.attendance_percentage }}</span>
                            <span class="card-percentage-unit">%</span>
                            <span class="card-status-badge">{{ subject.status_text }}</span>
                        </div>
                        <div class="card-progress-container">
                            <div class="card-progress-bar">
                                <div class="card-progress-fill" style="width: {{ subject.attendance_percentage }}%;"></div>
                            </div>
                            <div class="card-stats">
                                <div class="card-stat-item">
                                    <span class="card-stat-label">ì¶œì„</span>
                                    <span class="card-stat-value">{{ subject.present_count }}</span>
                                </div>
                                <div class="card-stat-item">
                                    <span class="card-stat-label">ì§€ê°</span>
                                    <span class="card-stat-value">{{ subject.late_count }}</span>
                                </div>
                                <div class="card-stat-item">
                                    <span class="card-stat-label">ê²°ì„</span>
                                    <span class="card-stat-value">{{ subject.absent_count }}</span>
                                </div>
                                <div class="card-stat-item">
                                    <span class="card-stat-label">ì´ ìˆ˜ì—…</span>
                                    <span class="card-stat-value">{{ subject.total_sessions }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state card">
            <p class="empty-message">ìˆ˜ê°• ì¤‘ì¸ ê³¼ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    document.querySelectorAll('.clickable-row').forEach(card => {
        card.addEventListener('click', () => {
            const subjectId = card.dataset.subjectId;
            window.location.href = `/attendance/detail/${subjectId}`;
        });
    });
</script>
{% endblock %}
