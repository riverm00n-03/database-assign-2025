{% extends "base.html" %}

{% block title %}{{ subject_name }} - 수업 목록 - WCheck{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='time_table.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='professor.css') }}">
    <style>
        .session-list-container {
            max-height: calc(100vh - 280px);
            overflow-y: auto;
            overflow-x: auto;
            position: relative;
        }
        
        .session-list-container::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        .session-list-container::-webkit-scrollbar-track {
            background: var(--bg-tertiary, #f8fafc);
            border-radius: 5px;
        }
        
        .session-list-container::-webkit-scrollbar-thumb {
            background: var(--border-dark, #cbd5e1);
            border-radius: 5px;
        }
        
        .session-list-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted, #64748b);
        }
        
        @media (max-width: 768px) {
            .session-list-container {
                max-height: calc(100vh - 240px);
            }
        }
    </style>
{% endblock %}

{% block header %}
    <header class="full-title-header">
        <div class="title-wrap" style="flex-wrap: wrap; gap: var(--spacing-sm);">
            <h1 class="page-title">{{ subject_name }} - 수업 목록</h1>
            <a href="{{ url_for('professor.lecture_list') }}" class="btn btn-secondary btn-sm" style="white-space: nowrap;">← 담당 과목 목록으로</a>
        </div>
    </header>
{% endblock %}

{% block content %}
        <div class="session-list-container card fade-in" style="max-width: 1200px; margin: 0 auto; padding: 0;">
            <table class="session-table table">
                <thead>
                    <tr>
                        <th>날짜</th>
                        <th>요일</th>
                        <th>시간</th>
                        <th style="width: 25%; text-align: center;">출결/휴강</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in sessions_info %}
                    {# '다음 수업'에 is_next_class 클래스 추가 #}
                    <tr class="{{ 'is_next_class' if session.is_next_class else '' }}" id="{{ 'next-class-anchor' if session.is_next_class else '' }}" style="transition: all var(--transition-fast);">
                        <td style="font-family: 'Courier New', monospace; font-weight: {% if session.is_next_class %}600{% else %}400{% endif %};">{{ session.class_date.strftime('%Y-%m-%d') }}</td>
                        <td>{{ session.day_of_week }}</td>
                        <td style="font-size: 13px; color: var(--text-secondary);">{{ session.start_time }} ~ {{ session.end_time }}</td>
                        <td class="session-actions">
                            <div style="display: flex; gap: var(--spacing-sm); align-items: center; justify-content: center; flex-wrap: wrap;">
                            {% if session.is_cancelled %}
                                <span class="badge badge-info">휴강</span>
                                {# 미래의 휴강된 수업만 취소 가능 #}
                                {% if session.class_date >= today %}
                                    <a href="{{ url_for('professor.uncancel_session', session_id=session.session_id) }}"
                                       class="btn btn-secondary btn-sm"
                                       onclick="return confirm('휴강 처리를 취소하시겠습니까?');">휴강 취소</a>
                                {% endif %}
                            {% else %}
                                {# 과거와 현재 수업만 출석부 확인 가능 #}
                                {% if session.class_date <= today %}
                                    <a href="{{ url_for('professor.manage_attendance_professor', session_id=session.session_id) }}" class="btn btn-success btn-sm">출석부 확인</a>
                                {% else %}
                                    {# 미래 수업은 비활성화 #}
                                    <a href="#" class="btn btn-sm disabled" aria-disabled="true" onclick="event.preventDefault(); alert('아직 진행되지 않은 수업의 출석부는 확인할 수 없습니다.');">출석부 확인</a>
                                {% endif %}
                                {# 미래의 수업만 휴강 가능 #}
                                {% if session.class_date >= today %}
                                    <a href="{{ url_for('professor.cancel_session', schedule_id=session.schedule_id, class_date=session.class_date.strftime('%Y-%m-%d')) }}"
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirm('정말로 이 수업을 휴강 처리하시겠습니까?');">휴강 처리</a>
                                {% endif %}
                            {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="no-data">수업 정보가 없습니다.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
{% endblock %}

{% block scripts %}
<script>
    // 페이지 로드 시 '다음 수업' 위치로 스크롤
    document.addEventListener('DOMContentLoaded', (event) => {
        const nextClassAnchor = document.getElementById('next-class-anchor');
        if (nextClassAnchor) {
            nextClassAnchor.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    });
</script>
{% endblock %}