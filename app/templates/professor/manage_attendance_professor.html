{% extends "base.html" %}

{% block title %}출석 관리 - WCheck{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='time_table.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='manage_attendance.css') }}">
{% endblock %}

{% block header %}
    <header class="full-title-header">
        <div class="title-wrap" style="flex-wrap: wrap; gap: var(--spacing-md); align-items: center;">
            <div style="flex: 1; min-width: 0;">
                <h1 class="page-title" style="font-size: 24px; margin-bottom: var(--spacing-xs); font-weight: 700; letter-spacing: -0.02em;">
                    {{ subject_name or '과목 정보 없음' }}
                </h1>
                <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-top: var(--spacing-xs);">
                    <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.6;">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span style="font-size: 15px; color: var(--text-secondary); font-weight: 500;">{{ class_date or '날짜 정보 없음' }}</span>
                </div>
            </div>
            <a href="{{ url_for('professor.list_subject_sessions', subject_id=subject_id) }}" class="btn btn-secondary btn-sm" style="white-space: nowrap; display: inline-flex; align-items: center; gap: var(--spacing-xs);">
                <svg class="icon-inline" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                수업 목록으로
            </a>
        </div>
    </header>
{% endblock %}

{% block content %}
        <div class="student-list-container fade-in">
            <!-- 출결 상태 업데이트를 위한 form -->
            <form method="POST" action="{{ url_for('professor.manage_attendance_professor', session_id=session_id) }}" onsubmit="alert('변경사항이 저장되었습니다.');">
                <table class="student-table table">
                    <thead>
                        <tr>
                            <th class="col-name">이름</th>
                            <th class="col-id">학번</th>
                            <th class="col-major">전공</th>
                            <th class="col-status">출결 상태</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 백엔드에서 학생 목록(students)을 전달받아 반복 처리 -->
                        {% for student in students %}
                        <tr style="transition: background-color var(--transition-fast);">
                            <td style="font-weight: 500; color: var(--text-primary);">{{ student.name }}</td>
                            <td style="font-family: 'Courier New', monospace; color: var(--text-secondary);">{{ student.student_number }}</td>
                            <td style="color: var(--text-secondary);">{{ student.student_major }}</td>
                            <td class="status-selector">
                                <div class="radio-group">
                                    <input type="radio" id="present_{{ student.student_id }}" name="status_{{ student.student_id }}" value="PRESENT" {% if student.status == 'PRESENT' %}checked{% endif %}>
                                    <label for="present_{{ student.student_id }}">출석</label>

                                    <input type="radio" id="late_{{ student.student_id }}" name="status_{{ student.student_id }}" value="LATE" {% if student.status == 'LATE' %}checked{% endif %}>
                                    <label for="late_{{ student.student_id }}">지각</label>

                                    <input type="radio" id="absent_{{ student.student_id }}" name="status_{{ student.student_id }}" value="ABSENT" {% if student.status == 'ABSENT' %}checked{% endif %}>
                                    <label for="absent_{{ student.student_id }}">결석</label>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="4">
                                <div class="empty-state-attendance">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.3; margin-bottom: var(--spacing-md);">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    <p class="empty-message-attendance">수강하는 학생이 없습니다.</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="form-actions" style="padding: var(--spacing-lg); text-align: right; background: var(--bg-tertiary); border-top: 1px solid var(--border-color);">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <svg class="icon-inline" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        변경사항 저장
                    </button>
                </div>
            </form>
        </div>
{% endblock %}
