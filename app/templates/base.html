<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}WCheck{% endblock %}</title>
    
    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='navbar.css') }}">
    
    <!-- íŽ˜ì´ì§€ë³„ ì¶”ê°€ ìŠ¤íƒ€ì¼ -->
    {% block styles %}{% endblock %}
    
    <!-- Pretendard í°íŠ¸ -->
    <link rel="stylesheet" as="style" crossorigin
          href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    
    <!-- ë©”ë‰´ ì•„ì´ì½˜ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="{{ url_for('static', filename='menu-icons.js') }}"></script>
</head>
<body>
    <!-- ìƒë‹¨ Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="{{ url_for('main.root') }}" class="navbar-brand">ðŸ“š WCheck</a>
            <ul class="navbar-menu" id="navbarMenu"></ul>
        </div>
    </nav>

    <!-- íŽ˜ì´ì§€ í—¤ë” -->
    {% block header %}{% endblock %}

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content">
        <div class="content-wrapper">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- í•˜ë‹¨ ë… ë°” (ëª¨ë°”ì¼) -->
    <div class="sidebar">
        <ul id="menuList" class="menu-list"></ul>
    </div>

    <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        (function() {
            const userRole = "{{ role }}";
            const currentPage = "{{ current_page|default('') }}";
            const menuList = document.getElementById("menuList");
            const navbarMenu = document.getElementById("navbarMenu");
            
            let menuItems = [];

            if (userRole === "student") {
                menuItems = [
                    { name: "ì‹œê°„í‘œ", url: "{{ url_for('timetable.timetable') }}" },
                    { name: "ì¶œì„ì²´í¬", url: "{{ url_for('attendance.show_attendance') }}" },
                    { name: "ì¶œì„ê´€ë¦¬", url: "{{ url_for('attendance.manage_attendance_students') }}" },
                    { name: "ë¡œê·¸ì•„ì›ƒ", url: "{{ url_for('auth.logout') }}" }
                ];
            } else if (userRole === "professor") {
                menuItems = [
                    { name: "ì¶œì„ ê´€ë¦¬", url: "{{ url_for('professor.lecture_list') }}" },
                    { name: "ì‹œê°„í‘œ", url: "{{ url_for('timetable.timetable') }}" },
                    { name: "ë¡œê·¸ì•„ì›ƒ", url: "{{ url_for('auth.logout') }}" }
                ];
            }

            // í˜„ìž¬ íŽ˜ì´ì§€ í‘œì‹œ
            menuItems.forEach(item => {
                if (currentPage && item.name === currentPage) {
                    item.current = true;
                }
            });

            // PC Navbar ë©”ë‰´ ìƒì„±
            function createNavbarMenuItem(item) {
                const li = document.createElement('li');
                const a = document.createElement('a');
                const isCurrent = item.current || false;
                
                if (isCurrent) {
                    a.classList.add('active');
                    a.href = '#';
                    a.addEventListener('click', (e) => e.preventDefault());
                } else {
                    a.href = item.url;
                }
                
                a.textContent = item.name;
                li.appendChild(a);
                return li;
            }

            // ëª¨ë°”ì¼ ë… ë°” ë©”ë‰´ ìƒì„±
            function createMobileMenuItem(item) {
                const isCurrent = item.current || false;
                if (typeof renderMenuItem === 'function') {
                    const li = renderMenuItem(item, isCurrent);
                    const link = li.querySelector('a');
                    if (isCurrent && link) {
                        link.addEventListener('click', (e) => e.preventDefault());
                    }
                    return li;
                } else {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = isCurrent ? '#' : item.url;
                    a.textContent = item.name;
                    if (isCurrent) {
                        a.addEventListener('click', (e) => e.preventDefault());
                    }
                    li.appendChild(a);
                    return li;
                }
            }

            // ë©”ë‰´ ë Œë”ë§
            if (navbarMenu) {
                menuItems.forEach(item => {
                    navbarMenu.appendChild(createNavbarMenuItem(item));
                });
            }
            
            if (menuList) {
                menuItems.forEach(item => {
                    menuList.appendChild(createMobileMenuItem(item));
                });
            }
        })();
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
