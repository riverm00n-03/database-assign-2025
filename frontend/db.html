<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB 스키마 확인</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        h2, h3 { color: #333; }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const schemaContainer = document.getElementById('schema-container');
            const dataContainer = document.getElementById('data-container');

            try {
                const schemaResponse = await fetch('/check-db');
                const schemaData = await schemaResponse.json();

                if (schemaData.status === 'error') {
                    schemaContainer.innerHTML = `<p style="color: red;">오류: DB 연결 또는 테이블 생성에 문제가 있습니다. (${schemaData.message})</p>`;
                    return;
                }

                for (const tableName in schemaData) {
                    const tableSchema = schemaData[tableName];
                    
                    // Display Schema
                    let schemaHtml = `<h3>Table: ${tableName} (Schema)</h3>`;
                    schemaHtml += `<table><thead><tr>`;
                    
                    if (tableSchema.length > 0) {
                        const headers = Object.keys(tableSchema[0]);
                        headers.forEach(header => {
                            schemaHtml += `<th>${header}</th>`;
                        });
                    }
                    schemaHtml += `</tr></thead><tbody>`;

                    tableSchema.forEach(row => {
                        schemaHtml += '<tr>';
                        for (const key in row) {
                            const cellValue = row[key] === null ? '-' : row[key];
                            schemaHtml += `<td>${cellValue}</td>`;
                        }
                        schemaHtml += '</tr>';
                    });

                    schemaHtml += `</tbody></table>`;
                    schemaContainer.innerHTML += schemaHtml;

                    // Display Data
                    const dataResponse = await fetch(`/table-data/${tableName}`);
                    const tableData = await dataResponse.json();

                    let dataHtml = `<h3>Table: ${tableName} (Data)</h3>`;
                    if (tableData.length > 0) {
                        dataHtml += `<table><thead><tr>`;
                        const dataHeaders = Object.keys(tableData[0]);
                        dataHeaders.forEach(header => {
                            dataHtml += `<th>${header}</th>`;
                        });
                        dataHtml += `</tr></thead><tbody>`;

                        tableData.forEach(row => {
                            dataHtml += '<tr>';
                            for (const key in row) {
                                const cellValue = row[key] === null ? '-' : row[key];
                                dataHtml += `<td>${cellValue}</td>`;
                            }
                            dataHtml += '</tr>';
                        });
                        dataHtml += `</tbody></table>`;
                    } else {
                        dataHtml += `<p>No data available for table ${tableName}.</p>`;
                    }
                    dataContainer.innerHTML += dataHtml;
                }
            } catch (error) {
                schemaContainer.innerHTML = `<p style="color: red;">네트워크 오류 발생: ${error.message}</p>`;
            }
        });
    </script>
</head>
<body>
    <h2>데이터베이스 스키마 상세 정보</h2>
    <div id="schema-container"></div>
    <h2>데이터베이스 내용</h2>
    <div id="data-container"></div>
</body>
</html>